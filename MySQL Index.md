# MySQL Index

---

[参考链接：数据库两大神器【索引和锁】](https://juejin.im/post/5b55b842f265da0f9e589e79#heading-2)

---

## 索引的基本描述

+ 索引可以加快数据库的检索速度
+ 表经常进行INSERT/UPDATE/DELETE操作就不要建立索引了，换言之：索引会降低插入、删除、修改等维护任务的速度
+ 索引需要占物理和数据空间
+ Mysql支持Hash索引和B+树索引两种

## MySQL索引结构

Mysql的基本存储结构是页（记录都存在页里边）：
![MySQL数据页结构图](./images/164c6d7a53a7920b)
![MySQL叶子节点插入数据示意图](./images/164c6d7a53b78847)

+ 各个数据页可以组成一个双向链表
+ 每个数据页中的记录又可以组成一个单向链表
  + 每个数据页都会为存储在它里边儿的记录生成一个页目录，在通过主键查找某条记录的时候可以在页目录中使用二分法快速定位到对应的槽，然后再遍历该槽对应分组中的记录即可快速找到指定的记录
  + 以其他列(非主键)作为搜索条件：只能从最小记录开始依次遍历单链表中的每条记录

## 哈希索引

哈希索引就是采用一定的哈希算法，把键值换算成新的哈希值，检索时不需要类似B+树那样从根节点到叶子节点逐级查找，只需一次哈希算法即可立刻定位到相应的位置，速度非常快
![哈希索引示意图](./images/164c6d7a55fd52b3)

哈希索引的特点：

+ 哈希索引也没办法利用索引完成排序
+ 不支持最左匹配原则
+ 在有大量重复键值情况下，哈希索引的效率也是极低的---->哈希碰撞问题
+ 不支持范围查询

## InnoDB和哈希索引

主流的还是使用B+树索引比较多，对于哈希索引，InnoDB是自适应哈希索引的（hash索引的创建由InnoDB存储引擎引擎自动优化创建，我们无法干预）
![官方文档对于哈希索引的说明](./images/164c6d7ac1c13504)

## 聚集索引与非聚集索引

+ 聚集索引就是以主键创建的索引
+ 非聚集索引就是以非主键创建的索引（非聚集索引也叫做二级索引）

区别：

+ 聚集索引在叶子节点存储的是`表中的数据`
+ 非聚集索引在叶子节点存储的是`主键和索引列`
+ 使用非聚集索引查询出数据时，拿到叶子上的主键再去查到想要查找的数据（拿到主键再查找这个过程叫做`回表`）

关于非聚集索引：

+ 非聚集索引可以使用多个列来创建
+ 创建多个单列(非聚集)索引的时候，会生成多个索引树(所以过多创建索引会占用磁盘空间)
+ 在创建多列索引中也涉及到了一种特殊的索引-->覆盖索引
  + 如果不是聚集索引，叶子节点存储的是`主键+列值`
  + 最终还是要“回表”，也就是要通过主键再查找一次
  + 覆盖索引就是把`要查询出的列和索引是对应的`，不做回表操作
  + 即，`能使用覆盖索引就尽量使用`
